"use strict";function initialize(a){ko.applyBindings(new ViewModel(a))}var map,DEFAULT_CENTER={lat:47,lng:23},DEFAULT_ZOOM=5;window.initMap=function(){var a={zoom:DEFAULT_ZOOM,center:DEFAULT_CENTER,mapTypeControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT}};map=new google.maps.Map(document.getElementById("map"),a),map.controls[google.maps.ControlPosition.RIGHT_TOP].push(legend),initialize()},window.mapError=function(){var a=!0;initialize(a)};var Place=function(a){this.name=ko.observable(a.capital+", "+a.name),this.region=ko.observable(a.region)},CoffeeShops=function(a){a.hasOwnProperty("venue")?(this.name=ko.observable(a.venue.name),this.venueId=ko.observable(a.venue.id),this.latitude=ko.observable(a.venue.location.lat),this.longitude=ko.observable(a.venue.location.lng)):(this.name=ko.observable(a.name),this.venueId=ko.observable(a.id),this.latitude=ko.observable(a.location.lat),this.longitude=ko.observable(a.location.lng))},ViewModel=function(a){var b=this,c="Google Maps API cannot be reached. Please try again later.",d="To add favorites, click on coffee shop name in the list or marker then click on the star next to the coffee shop name. Please click on the above back button to return to the capitals list.",e="Foursquare API cannot be reached. Please try again later.",f="REST Countries API cannot be reached. Please try again later.",g="No coffee shops found in this capital, please press the back button and choose a different location.";b.mapErrorTextUpdate=ko.observable(),b.errorMsg=ko.observable(""),b.allPlaceList=ko.observableArray([]),b.currentRegionList=ko.observable([]),b.africa=ko.observableArray([]),b.americas=ko.observableArray([]),b.asia=ko.observableArray([]),b.europe=ko.observableArray([]),b.oceania=ko.observableArray([]),b.filteredList=ko.observableArray([]),b.searchValue=ko.observable(),b.coffeeShopList=ko.observableArray([]),b.markerList=ko.observableArray([]),b.latLngList=ko.observableArray([]),b.idList=ko.observableArray([]),b.foursquareError=ko.observable(),b.noCoffee=ko.observable(!1),b.currentVenue=ko.observable(),b.starClick=ko.observable(!1),b.favoritesList=ko.observableArray([]),b.faveBtnClick=ko.observable(!1),b.noFavorites=ko.observable(!1),b.favoritesLength=ko.observable(),b.faveBtnText=ko.observable();var h="5PLNSFDCFOXXWLZOHDRG33R3PLP5OULVV0NQDPLZMOCON3OL",i="DFRQK4JG21B1ECQ104LLNMH1O5TUQ4OZC2C24AAKZCTEPJAG",j="20151221";a?b.mapErrorTextUpdate(c):b.mapErrorTextUpdate(),null!==localStorage.getItem("favoriteKey")&&b.favoritesList(JSON.parse(localStorage.getItem("favoriteKey"))),b.favorites=ko.computed(function(){b.starClick()&&($("#favorite").toggleClass("starred"),b.updateFavorites(),b.starClick(!1)),b.favoritesLength(b.favoritesList().length),b.faveBtnText("My Favorites ("+b.favoritesLength()+")")},b),b.checkFavorites=function(){var a,c=b.currentVenue().id,d=!1,e=b.favoritesList().length;for(a=0;e>a;a++){var f=b.favoritesList()[a].id;if(c===f){d=!0;break}}d&&$("#favorite").toggleClass("starred")},b.updateFavorites=function(){var a=$("#favorite").hasClass("starred");if(a)b.favoritesList().push(b.currentVenue()),localStorage.setItem("favoriteKey",JSON.stringify(b.favoritesList())),b.markerIcon();else{var c,d=b.favoritesList().length,e=b.currentVenue().id;for(c=0;d>c;c++){var f=b.favoritesList()[c].id;if(e===f)break}b.favoritesList().splice(c,1),localStorage.setItem("favoriteKey",JSON.stringify(b.favoritesList())),b.markerIcon()}},b.markerIcon=function(){var a,c=b.markerList().length;if(0!=b.favoritesList().length){var d,e=b.favoritesList().length;for(a=0;c>a;a++){var f=b.markerList()[a].markerId;for(d=0;e>d;d++){var g=b.favoritesList()[d].name+", "+b.favoritesList()[d].id;if(f===g){b.markerList()[a].setIcon("images/faveCoffee.png");break}b.markerList()[a].setIcon("images/coffee.png")}}}else for(a=0;c>a;a++)b.markerList()[a].setIcon("images/coffee.png")},b.listFavorites=function(){b.favoritesList().length>0?(b.faveBtnClick(!0),b.getCoffee()):b.noFavorites(!0)},b.setRegion=function(a){b.errorMsg(""),b.searchValue(""),b.coffeeShopList([]),b.getMarkers(),b.noCoffee(!1),b.foursquareError(!1),"Africa"==a?b.currentRegionList(b.africa()):"Americas"==a?b.currentRegionList(b.americas()):"Asia"==a?b.currentRegionList(b.asia()):"Europe"==a?b.currentRegionList(b.europe()):"Oceania"==a&&b.currentRegionList(b.oceania())},b.filter=ko.computed(function(){b.noFavorites()?(b.filteredList([]),b.coffeeShopList([]),b.searchValue(""),b.getMarkers(),b.errorMsg(d),b.noFavorites(!1)):b.foursquareError()?b.filteredList([]):b.noCoffee()?(b.filteredList([]),b.errorMsg(g)):0==b.coffeeShopList().length||0!=b.noFavorites()||""!=b.searchValue()&&void 0!=b.searchValue()?0!=b.coffeeShopList().length||""!=b.searchValue()&&void 0!=b.searchValue()?(b.filteredList([]),0!=b.coffeeShopList().length?(b.filterCurrentList(b.coffeeShopList()),b.getMarkers()):0==b.currentRegionList().length?b.filterCurrentList(b.allPlaceList()):b.filterCurrentList(b.currentRegionList())):0==b.currentRegionList().length?b.filteredList(b.allPlaceList()):b.filteredList(b.currentRegionList()):(b.filteredList(b.coffeeShopList()),b.getMarkers()),b.idList(b.filteredList())},b),b.filterCurrentList=function(a){var c,d=a.length;for(c=0;d>c;c++){var e=a[c].name().toLowerCase();e.includes(b.searchValue().toLowerCase())&&b.filteredList.push(a[c])}},void 0!=map&&map.addListener("click",function(){if(0!=b.markerList().length){var a,c=b.markerList().length;for(a=0;c>a;a++)b.markerList()[a].setAnimation(null)}b.infowindow.close()}),b.back=function(){b.foursquareError(!1),b.errorMsg(""),b.searchValue(""),b.noCoffee()?(b.noCoffee(!1),b.filteredList(b.currentRegionList())):0!=b.currentRegionList().length&&0!=b.coffeeShopList().length?(b.coffeeShopList([]),b.filteredList(b.currentRegionList())):(b.currentRegionList([]),b.coffeeShopList([]),b.filteredList(b.allPlaceList())),b.getMarkers(),null!=b.infowindow&&b.infowindow.close()},b.getCoffee=function(a){if(b.faveBtnClick()){b.faveBtnClick(!1);var c=$.map(b.favoritesList(),function(a){return new CoffeeShops(a)});b.coffeeShopList(c),b.filteredList(b.coffeeShopList()),b.searchValue("")}else if(0==b.coffeeShopList().length){var d=b.filteredList()[a].name(),f="https://api.foursquare.com/v2/venues/explore?near="+d+"&section=coffee&limit=25&client_id="+h+"&client_secret="+i+"&v="+j;$.getJSON(f,function(a){var c=$.map(a.response.groups[0].items,function(a){return new CoffeeShops(a)});b.coffeeShopList(c),b.filteredList(b.coffeeShopList()),b.searchValue("")}).complete(function(){0==b.coffeeShopList().length&&b.noCoffee(!0)}).fail(function(){b.foursquareError(!0),b.errorMsg(e)})}},b.getMarkers=function(){var a,c=b.markerList().length;for(a=0;c>a;a++)b.markerList()[a].setMap(null);if(b.markerList([]),0!=b.coffeeShopList().length){var d=b.filteredList().length;for(a=0;d>a;a++){var e=b.filteredList()[a].name(),f=b.filteredList()[a].venueId(),g={lat:b.filteredList()[a].latitude(),lng:b.filteredList()[a].longitude()};b.markerList().push(new google.maps.Marker({title:e,position:g,animation:null,markerId:e+", "+f}))}}b.markerIcon(),b.placeMarkers()},b.placeMarkers=function(){if(0==b.coffeeShopList().length)map.setCenter(DEFAULT_CENTER),map.setZoom(DEFAULT_ZOOM);else{var a,c=b.markerList().length;for(a=0;c>a;a++)b.markerList()[a].setMap(map),b.markerList()[a].addListener("click",function(a){return function(){b.toggleBounce(a),b.toggleWindow(a)}}(a));0!=c&&b.setBounds()}},b.setBounds=function(){b.latLngList([]),b.bounds=new google.maps.LatLngBounds;var a,c=b.markerList().length;for(a=0;c>a;a++){var d={lat:b.markerList()[a].position.lat(),lng:b.markerList()[a].position.lng()};b.latLngList().push(new google.maps.LatLng(d))}var e=b.latLngList().length;for(a=0;e>a;a++)b.bounds.extend(b.latLngList()[a]);map.fitBounds(b.bounds)},b.toggleBounce=function(a){var c,d=b.markerList().length;for(c=0;d>c;c++){var e=b.markerList()[c];c==a&&null==e.getAnimation()?e.setAnimation(google.maps.Animation.BOUNCE):e.setAnimation(null)}},b.toggleWindow=function(a){var c,d=b.idList()[a].venueId(),e="/venues/"+d,f="/venues/"+d+"/hours",g="https://api.foursquare.com/v2/multi?requests="+e+","+f+"&client_id="+h+"&client_secret="+i+"&v="+j;$.ajax({url:g,dataType:"json",success:function(d){b.currentVenue(d.response.responses[0].response.venue),c=!1;var e;b.getIwContent(c,a);var f,g,h,i,j,k=b.currentVenue().name,l=b.currentVenue().rating,m=d.response.responses[1].response.hours,n=b.currentVenue().tips.groups[0].count,o=b.currentVenue().canonicalUrl;if(b.currentVenue().hasOwnProperty("url")){var p=b.currentVenue().url;$("#iw-title").prepend('<a href="'+p+'" target="_blank">'+k+"</a>")}else $("#iw-title").prepend(k);if(void 0!=l?$("#iw-rating").append(l+"/10"):$("#iw-rating").append("No rating to show."),b.currentVenue().hasOwnProperty("bestPhoto")&&window.matchMedia("(min-height: 500px)").matches&&(f=b.currentVenue().bestPhoto.prefix+"original"+b.currentVenue().bestPhoto.suffix),void 0!=f?$("#iw-photo").append('<img src="'+f+'"style="width:100%; height: auto, display: block">'):($("#iw-photo").remove(),$("#hasPhoto").toggleClass("col-md-5 col-md-12")),b.currentVenue().hasOwnProperty("hours")?(1==b.currentVenue().hours.isOpen?$("#iw-isOpen").prepend("<p>Open Now</p>").css({color:"green"}):$("#iw-isOpen").prepend("<p>Closed Now</p>").css({color:"red"}),b.currentVenue().hours.hasOwnProperty("status")?$("#iw-status").append("<p>"+b.currentVenue().hours.status+"</p>"):$("#iw-status").remove()):$("#iw-isOpen").remove(),m.hasOwnProperty("timeframes")){var q=m.timeframes,r=q.length;for(e=0;r>e;e++){var s,t=q[e].days,u=q[e].open,v=t.length;for(s=0;v>s;s++){var w,x=b.getDay(t[s]),y=u.length;for(w=0;y>w;w++){var z=b.getTime(u[w].start),A=b.getTime(u[w].end);b.appendHours(x,z,A,w)}}}}else $("#iw-hours ul").remove(),$("#iw-hours").append("<p>No information available</p>");if(b.currentVenue().hasOwnProperty("description")?(g=b.currentVenue().description,$("#iw-description").append("<p>About</p>"),$("#iw-description").append("<p>"+g+"</p>")):$("#iw-description").remove(),0==n?$("#iw-tips").remove():(h=b.currentVenue().tips.groups[0].items,b.getTips(h),$("#iw-tips").prepend('<p class="hasTips">What others have to say</p>')),b.currentVenue().contact.hasOwnProperty("formattedPhone")?(i=b.currentVenue().contact.formattedPhone,$("#iw-phoneIcon").append('<i class="fa fa-phone-square"></i>'),$("#iw-phoneNum").append("<p>"+i+"</p>")):($("#iw-phoneIcon").remove(),$("#iw-phoneNum").remove()),$("#iw-social").append('<a href="'+o+'" target="_blank"><i class="fa fa-foursquare"></i></a>'),b.currentVenue().contact.hasOwnProperty("facebook")){var B=b.currentVenue().contact.facebook;$("#iw-social").append('<a href="https://www.facebook.com/'+B+'" target="_blank"><i class="fa fa-facebook-official"></i></a>')}if(b.currentVenue().contact.hasOwnProperty("twitter")){var C=b.currentVenue().contact.twitter;$("#iw-social").append('<a href="https://www.twitter.com/'+C+'" target="_blank"><i class="fa fa-twitter"></i></a>')}if(b.currentVenue().location.hasOwnProperty("formattedAddress")){var D=b.currentVenue().location.formattedAddress.length;for(e=0;D>e;e++)j=b.currentVenue().location.formattedAddress[e],$("#iw-formattedAddress").append("<p>"+j+"</p>")}b.checkFavorites()}}).fail(function(){c=!0,b.getIwContent(c,a)}),b.markerAnimation=b.markerList()[a].getAnimation(),null!=b.infowindow&&b.infowindow.close(),b.infowindow=new google.maps.InfoWindow({pixelOffset:new google.maps.Size(0,-10),content:'<div class="container iw-container"><div class="row"><div class="col-md-12 loading"><i class="fa fa-spinner fa-spin"></i></div></div></div>'}),b.infowindow.addListener("domready",function(){$(".gm-style-iw").next("div").hide();var a=$(".gm-style-iw"),b=a.prev();b.children(":nth-child(2)").css({display:"none"}),b.children(":nth-child(4)").css({display:"none"}),b.children(":nth-child(3)").find("div").children().css({border:"2px solid orange"})}),null!=b.infowindow&&b.infowindow.open(map,b.markerList()[a]),b.getIwContent=function(a,c,d){var e;if(0==a)e='<div class="container iw-container"><div class="row"><div class="col-md-12" id="iw-title"><i id="favorite" class="fa fa-star"></i></div></div><div class="row"><div class="col-md-2" id="iw-rating"></div></div><div class="row"><div class="col-md-7" id="iw-photo"></div><div class="col-md-5" id="hasPhoto"><div class="row"><div class="col-md-12" id="iw-isOpen"></div></div><div class="row"><div class="col-md-12" id="iw-status"></div></div><div class="row"><div class="col-md-12" id="iw-hoursOO"><p>Hours of Operation</p></div></div><div class="row"><div class="col-md-12" id="iw-hours"><ul><li id="mon"><span>Monday</span><div>CLOSED</div></li><li id="monExtra"></li><li id="tue"><span>Tuesday</span><div>CLOSED</div></li><li id="tueExtra"></li><li id="wed"><span>Wednesday</span><div>CLOSED</div></li><li id="wedExtra"></li><li id="thu"><span>Thursday</span><div>CLOSED</div></li><li id="thuExtra"></li><li id="fri"><span>Friday</span><div>CLOSED</div></li><li id="friExtra"></li><li id="sat"><span>Saturday</span><div>CLOSED</div></li><li id="satExtra"></li><li id="sun"><span>Sunday</span><div>CLOSED</div></li><li id="sunExtra"></li></ul></div></div></div></div><div class="row"><div class="col-md-12" id="iw-description"></div></div><div class="row"><div class="col-md-12" id="iw-tips"></div></div><div class="row"><div class="col-md-12"><div class="row"><div class="col-md-6" id="iw-contact"><p>Contact</p><div class="row"><div class="col-md-4" id="iw-phoneIcon"></div><div class="col-md-8" id="iw-phoneNum"></div></div><div class="row"><div class="col-md-12" id="iw-social"></div></div></div><div class="col-md-6" id="iw-location"><p>Location</p><div class="row"><div class="col-md-12" id="iw-formattedAddress"></div></div></div></div></div></div></div>',b.infowindow.open(map,b.markerList()[c]),null==b.markerAnimation&&b.infowindow.close();else{var f=b.filteredList()[c].name();e='<div class="container iw-container"><div class="row"><div class="col-md-12" id="iw-title"><p>'+f+'</p></div></div><div class="row"><div class="col-md-12"><p class="apiError">Foursquare API cannot be reached. Please try again later.</p></div></div></div>',b.infowindow.open(map,b.markerList()[c])}b.infowindow.setContent(e),$("#favorite").click(function(){b.starClick(!0)})},b.getDay=function(a){return 1==a?"Monday":2==a?"Tuesday":3==a?"Wednesday":4==a?"Thursday":5==a?"Friday":6==a?"Saturday":7==a?"Sunday":void 0},b.getTime=function(a){var b,c,d,e=a.slice(0,1);return"+"==e&&(a=a.slice(1)),1200==a?"Noon":0==a?"Midnight":a>=1200?(b=12==a.slice(0,2)?a.slice(0,2):a.slice(0,2)-12,c=a.slice(2),d=b+":"+c+" PM"):1e3>a?(b=0==a.slice(0,2)?"12":a.slice(1,2),c=a.slice(2),d=b+":"+c+" AM"):(b="00"==a.slice(0,2)?"12":a.slice(0,2),c=a.slice(2),d=b+":"+c+" AM")},b.appendHours=function(a,b,c,d){0==d?"Monday"==a?$("#mon").replaceWith("<li><span>"+a+"</span><div>"+b+" - "+c+"</div></li>"):"Tuesday"==a?$("#tue").replaceWith("<li><span>"+a+"</span><div>"+b+" - "+c+"</div></li>"):"Wednesday"==a?$("#wed").replaceWith("<li><span>"+a+"</span><div>"+b+" - "+c+"</div></li>"):"Thursday"==a?$("#thu").replaceWith("<li><span>"+a+"</span><div>"+b+" - "+c+"</div></li>"):"Friday"==a?$("#fri").replaceWith("<li><span>"+a+"</span><div>"+b+" - "+c+"</div></li>"):"Saturday"==a?$("#sat").replaceWith("<li><span>"+a+"</span><div>"+b+" - "+c+"</div></li>"):"Sunday"==a&&$("#sun").replaceWith("<li><span>"+a+"</span><div>"+b+" - "+c+"</div></li>"):"Monday"==a?$("#monExtra").replaceWith('<li><span style="visibility:hidden">AND</span><div>'+b+" - "+c+"</div></li>"):"Tuesday"==a?$("#tueExtra").replaceWith('<li><span style="visibility:hidden">AND</span><div>'+b+" - "+c+"</div></li>"):"Wednesday"==a?$("#wedExtra").replaceWith('<li><span style="visibility:hidden">AND</span><div>'+b+" - "+c+"</div></li>"):"Thursday"==a?$("#thuExtra").replaceWith('<li><span style="visibility:hidden">AND</span><div>'+b+" - "+c+"</div></li>"):"Friday"==a?$("#friExtra").replaceWith('<li><span style="visibility:hidden">AND</span><div>'+b+" - "+c+"</div></li>"):"Saturday"==a?$("#satExtra").replaceWith('<li><span style="visibility:hidden">AND</span><div>'+b+" - "+c+"</div></li>"):"Sunday"==a&&$("#sunExtra").replaceWith('<li><span style="visibility:hidden">AND</span><div>'+b+" - "+c+"</div></li>")},b.getTips=function(a){var c,d,e,f,g,h;for(g=a.length>5?5:a.length,h=0;g>h;h++)c=a[h].text,a[h].hasOwnProperty("user")?(d=a[h].user.hasOwnProperty("firstName")?a[h].user.firstName:"",e=a[h].user.hasOwnProperty("lastName")?a[h].user.lastName:""):(d="",e=""),f=""!=d&&""!=e?d+" "+e:""!=d&&""==e?d:""==d&&""!=e?e:"Unknown",b.appendTips(c,f,g,h)},b.appendTips=function(a,b,c,d){var e="<blockquote><p>"+a+"</p><footer>"+b+"</footer></blockquote>";c-1!=d?$("#iw-tips").append(e+"<hr>"):$("#iw-tips").append(e)}},b.onListClick=function(a){0==b.markerList()?b.getCoffee(a):(b.toggleBounce(a),b.toggleWindow(a))};var k="https://restcountries.eu/rest/v1/all";$.getJSON(k,function(a){var c=$.map(a,function(a){return""!=a.capital&&""!=a.region?new Place(a):void 0});b.allPlaceList(c)}).complete(function(){var a,c=b.allPlaceList().length;for(a=0;c>a;a++){var d=b.allPlaceList()[a];"Africa"==d.region()?b.africa().push(d):"Americas"==d.region()?b.americas().push(d):"Asia"==d.region()?b.asia().push(d):"Europe"==d.region()?b.europe().push(d):"Oceania"==d.region()&&b.oceania().push(d)}}).fail(function(){b.errorMsg(f)})};